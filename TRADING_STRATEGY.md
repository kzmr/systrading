# XRP/JPY 自動トレーディング戦略

## 概要

**戦略名**: 高値安値ブレイクアウト戦略（HighLowBreakoutStrategy）
**対象通貨ペア**: XRP/JPY
**取引モード**: ペーパートレード（GMOコイン実データ使用）
**実行頻度**: 1分ごと自動実行

---

## エントリー条件

### ロングエントリー
- 直近20本の**高値**を**0.2%以上**ブレイクアウト
- スプレッドが現在価格の**0.1%以内**
- 同一方向のポジション数が**3つ未満**

### ショートエントリー
- 直近20本の**安値**を**0.2%以上**ブレイクダウン
- スプレッドが現在価格の**0.1%以内**
- 同一方向のポジション数が**3つ未満**

---

## エグジット条件（3段階リスク管理）

### 1. 固定損切り（最終防衛ライン）
- **ロング**: エントリー価格の **-1%** で強制決済
- **ショート**: エントリー価格の **+1%** で強制決済
- 目的: 大きな損失を防ぐ

### 2. トレーリングストップ（利益確定）
- **初期設定**: エントリー価格 ± 1.5%
- **動的更新**: 直近20本の安値/高値 - 0.3%
- **更新条件**: 有利な方向のみ（ストップを引き上げのみ）
- **発動**: 価格が反転してストップ価格に到達で自動決済
- 目的: 利益を伸ばしつつ、反転時に自動利益確定

### 3. 逆方向ブレイク時の強制決済
- **ロング保有中**: 安値ブレイクダウン → 全ロング決済 → ショート新規
- **ショート保有中**: 高値ブレイクアウト → 全ショート決済 → ロング新規
- 目的: トレンド転換に即座に対応

---

## ポジション管理

- **最大ポジション数**: 同一方向に最大3つまで
- **ポジションサイズ**: 0.01 XRP/ポジション
- **重複エントリー**: 同一方向ブレイクで追加エントリー可能
- **一斉決済**: 逆方向ブレイク時は全ポジション決済

---

## 戦略パラメータ

| パラメータ | 設定値 | 説明 |
|----------|--------|------|
| lookback_period | 20本 | 高値安値の判定期間 |
| breakout_threshold | **0.2%** ⭐ | ブレイクアウト判定の閾値（最適化済み） |
| max_spread_percentage | 0.1% | エントリー時の最大許容スプレッド |
| stop_loss_percent | 1.0% | 固定損切り幅 |
| trailing_stop_offset | 0.5% | トレーリングストップのオフセット |
| max_positions | 3 | 同一方向の最大ポジション数 |
| trade_size | 0.01 XRP | 1ポジションあたりの取引量 |

---

## 実装済み機能

- ✅ 高値安値ブレイクアウト検出
- ✅ 固定損切り（1%）
- ✅ トレーリングストップ（動的利益確定）
- ✅ スプレッド制限（割合ベース）
- ✅ マルチポジション対応（最大3つ）
- ✅ 逆方向ブレイク時の自動決済・転換
- ✅ 価格履歴の自動記録
- ✅ 全取引ログの記録

---

## 実行コマンド

```bash
# システム起動
php artisan schedule:work

# システム停止
pkill -f schedule:work

# 手動実行（テスト用）
php artisan trading:execute

# 現在のポジション確認
./show_current_positions.sh

# 取引ログ確認
./show_trading_logs.sh
```

---

## リスク管理の考え方

本戦略は**3層防御**でリスクを管理：

1. **固定損切り（1%）**: 最悪のケースでも損失を限定
2. **トレーリングストップ（0.3%）**: 利益を伸ばしつつ反転時に自動確定
3. **逆方向ブレイク決済**: トレンド転換を見逃さず即座に対応

これにより、**大きく伸ばして小さく損切る**トレンドフォロー型の運用を実現。

---

## 注意事項

- 現在は**ペーパートレード**で稼働中（実資金ではない）
- 本番運用前に十分な期間のテストが必要
- ボラティリティの高い相場では損切りが連続する可能性あり
- スプレッドが広がる時間帯（早朝など）はエントリー見送り

---

**最終更新**: 2025-12-04
**バージョン**: v1.1（スプレッドチェック追加版）
