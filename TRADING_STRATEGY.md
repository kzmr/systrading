# 自動トレーディング戦略

## 概要

**現在運用中**: RSI逆張り戦略（BTC/JPY）
**取引所**: GMOコイン
**実行頻度**: 1分ごと自動実行
**手数料**: 約0.05%（往復で約0.1%）※自動トラッキング対応

---

## 運用中の戦略

### RSI逆張り戦略（RSIContrarianStrategy）【メイン】

RSI（相対力指数）を使った逆張り戦略。売られすぎ・買われすぎの水準で反転を狙う。

#### エントリー条件

| 条件 | ロング | ショート |
|------|--------|----------|
| RSI | < 25（売られすぎ）※厳格化 | > 75（買われすぎ）※厳格化 |
| スプレッド | 0.1%以内 | 0.1%以内 |
| ポジション | 上限未達 | 上限未達 |

**手数料対策**: エントリー条件を厳格化（RSI 25/75）し、取引回数を削減しつつ反発幅を拡大

#### 決済条件

1. **RSI利確（ロング）**: RSI ≥ 55 で決済
2. **RSI利確（ショート）**: RSI ≤ 45 で決済
3. **タイムアウト**: 60分経過で強制決済
4. **損切り**: 1%逆行で強制決済
5. **トレーリングストップ**: 利益方向に追跡

**手数料対策**: 決済閾値を非対称化（55/45）し、より大きな利幅を確保

#### パラメータ（BTC/JPY・現在運用中）

| パラメータ | 設定値 | 説明 |
|-----------|--------|------|
| rsi_period | 60 | RSI計算期間 |
| rsi_oversold | 25 | 買いエントリー閾値（厳格化） |
| rsi_overbought | 75 | 売りエントリー閾値（厳格化） |
| rsi_exit_threshold_long | 55 | ロング利確閾値 |
| rsi_exit_threshold_short | 45 | ショート利確閾値 |
| trade_size | 0.01 | 取引サイズ（BTC） |
| max_positions | 1 | 最大ポジション数 |
| max_hold_minutes | 60 | 最大保有時間 |
| stop_loss_percent | 1.0 | 固定損切り |

---

### 高値安値ブレイクアウト戦略（HighLowBreakoutStrategy）

過去N本の価格レンジをブレイクした時にエントリー。トレンドフォロー型。

#### エントリー条件

- **ロング**: 現在価格 > 過去20本の最高値 × 1.004（0.4%ブレイク）
- **ショート**: 現在価格 < 過去20本の最安値 × 0.996

#### 決済条件

1. **逆方向ブレイク**: 全ポジション一斉決済 + 逆方向エントリー
2. **損切り**: 1%逆行で強制決済
3. **トレーリングストップ**: 利益方向に追跡

#### パラメータ

| パラメータ | 設定値 |
|-----------|--------|
| lookback_period | 20 |
| breakout_threshold | 0.4% |
| max_positions | 3 |

---

## 共通リスク管理機能

### 1. 固定損切り（1%）
- エントリー価格から1%逆行で強制決済
- 全戦略・全ポジションに適用

### 2. トレーリングストップ
- 初期: エントリー価格 ± 0.7%
- 追跡: 現在価格 ± 0.5%（利益方向のみ更新）
- 全戦略・全ポジションに適用

### 3. スプレッドチェック
- 新規エントリー時のみチェック（0.1%上限）
- 決済時はチェックなし（即座に執行）

### 4. 手数料トラッキング
- **entry_fee**: エントリー時の手数料（GMO APIから自動取得）
- **exit_fee**: 決済時の手数料
- **net_profit_loss**: 純損益（profit_loss - 手数料合計）
- `show_current_positions.sh` で確認可能

**BTC往復手数料目安**: 約150円（0.01 BTC × 1500万円 × 0.1%）

---

## マルチ戦略運用

同一通貨ペアで複数戦略を運用可能：

- 各戦略は`trading_settings_id`で自分のポジションを識別
- 戦略ベース決済（RSI利確等）は自分のポジションのみ対象
- 損切り・トレーリングは全ポジションに適用

---

## 実行コマンド

```bash
# システム起動
php artisan schedule:work

# システム停止
pkill -f schedule:work

# 手動実行（テスト用）
php artisan trading:execute

# ポジション確認
./show_current_positions.sh

# ログ確認
./show_trading_logs.sh
```

---

**最終更新**: 2026-01-08
**バージョン**: v2.1（手数料トラッキング追加、RSI利確閾値の非対称化）
